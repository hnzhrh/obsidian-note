---
title: vmstat 命令
tags:
  - permanent-note
  - linux/command
date: 2025-03-06
time: 17:05
aliases:
---

下面是一份详细介绍 Linux vmstat 命令的说明，帮助你了解它的用途、基本语法、常用选项以及各个输出字段的含义。

---

## 1. 概述

vmstat（Virtual Memory Statistics，虚拟内存统计）是 Linux/Unix 系统中常用的监控工具，用于报告系统的整体状态。  
它可以展示：
- **进程情况**（例如正在运行和等待 CPU 的进程数）
- **内存使用情况**（物理内存、缓冲区、缓存）
- **交换区状态**（交换入/交换出的速率）
- **I/O 活动**（磁盘块读写情况）
- **系统活动**（中断数、上下文切换数）
- **CPU 状态**（用户态、内核态、空闲、I/O 等待时间等）

这种工具具有低开销的特点，非常适合在高负载环境下监控系统性能和排查瓶颈问题。

> citeturn0search0

---

## 2. 基本语法和使用方法

vmstat 的基本语法如下：

```bash
vmstat [options] [delay [count]]
```

- **delay**：刷新时间间隔（秒）。例如，`vmstat 2` 表示每隔 2 秒刷新一次。
- **count**：采样次数。如果不指定 count，但指定了间隔，则 vmstat 会一直运行直到中断。

例如：
```bash
vmstat 2 5
```
表示每 2 秒采集一次数据，总共采集 5 次。

> citeturn0search1

---

## 3. 常用选项

vmstat 命令支持多种选项，常见的有：

- **-a**  
  显示活跃和非活跃内存（active/inactive memory）信息，帮助判断哪些内存是正在被频繁使用的。
  
- **-f**  
  显示系统启动以来 fork（派生）进程的总数，反映进程创建情况。

- **-m**  
  显示 slab 信息，即内核中用于小对象分配的缓存信息。

- **-s**  
  以表格形式显示详细的内存统计信息，包括内存总量、已用内存、空闲内存、缓冲内存等。  
  > citeturn0search2

- **-d**  
  显示磁盘统计信息，查看磁盘读写情况。

- **-p**  
  显示指定磁盘分区的统计信息。

- **-S unit**  
  设置显示内存数据的单位。参数包括：
  - k 或 K：1000 或 1024 字节
  - m 或 M：1000000 或 1048576 字节  
  默认单位通常为 K（1024 字节）。
  
- **-n**  
  当进行多次采样时，只在第一次输出时显示标题，后续只显示数据，避免重复输出标题。

- **-V**  
  显示 vmstat 版本信息。

> citeturn0search3

---

## 4. 输出字段详解

vmstat 的输出通常分为以下几大部分，每个字段的含义如下：

### 4.1 进程（procs）

- **r**  
  运行队列中处于可运行状态的进程数。如果这个值持续高于 CPU 核数，则可能存在 CPU 瓶颈。

- **b**  
  阻塞（等待 I/O）的进程数。如果该值较高，则可能存在 I/O 方面的问题。

### 4.2 内存（memory）

- **swpd**  
  已使用的虚拟内存大小（单位通常为 KB）。如果该值大于 0，表示系统部分内存已被交换出去，可能是物理内存不足或存在内存泄漏。

- **free**  
  空闲物理内存大小。

- **buff**  
  系统用作缓冲的内存，通常用于存储目录信息、权限等元数据。

- **cache**  
  用作文件系统缓存的内存。Linux 会将部分空闲内存用作缓存，以提高文件读写性能。

### 4.3 交换（swap）

- **si**  
  每秒从交换区读入内存的大小（swap in），单位为 KB。如果该值长期大于 0，说明系统可能需要频繁从磁盘加载数据，提示内存压力较大。

- **so**  
  每秒写入交换区的内存大小（swap out）。同样，长期大于 0 表示存在内存压力或内存泄漏问题。

### 4.4 I/O

- **bi**  
  每秒从块设备读入的块数，默认单位为 1KB 块。高的读入值可能表明大量磁盘读操作。

- **bo**  
  每秒写入块设备的块数。高的写出值可能表示大量的磁盘写操作。

### 4.5 系统（system）

- **in**  
  每秒中断的数量，包括时钟中断等。中断数的急剧增加可能影响系统响应速度。

- **cs**  
  每秒上下文切换次数。过高的上下文切换表示 CPU 在进程或线程间频繁切换，这通常会降低系统性能。

### 4.6 CPU

- **us**  
  用户态（非内核态）消耗的 CPU 时间百分比。如果此值过高，可能说明用户进程（如应用程序）占用大量 CPU。

- **sy**  
  内核态消耗的 CPU 时间百分比。过高可能表示系统调用或内核操作较多，可能由 I/O 等原因引起。

- **id**  
  CPU 空闲时间百分比。通常 id + us + sy = 100%，id 值越低表示 CPU 越忙。

- **wa**  
  CPU 等待 I/O 完成的时间百分比。如果此值较高，说明 CPU 在等待磁盘或网络 I/O 操作完成。

- （在某些系统中还可能有 **st** 字段，表示虚拟化环境中“窃取”（steal）的 CPU 时间。）

> citeturn0search1

---

## 5. 使用示例

### 5.1 基本采样

```bash
# 每隔 2 秒采样一次，连续输出（直到手动停止）
vmstat 2
```

### 5.2 指定采样次数

```bash
# 每隔 2 秒采样一次，总共采样 5 次
vmstat 2 5
```

### 5.3 显示详细内存统计信息

```bash
# 显示内存相关的统计信息（一次输出）
vmstat -s
```

### 5.4 显示活跃和非活跃内存

```bash
# 显示活跃（active）和非活跃（inactive）内存
vmstat -a 2 5
```

### 5.5 以指定单位显示内存数据

```bash
# 使用 M（兆字节）作为单位显示
vmstat -S M 2 5
```

> citeturn0search2

---

## 6. 使用场景和注意事项

- **系统监控**  
  管理员可以利用 vmstat 实时监控系统负载，判断 CPU 是否饱和、内存是否足够、磁盘 I/O 是否异常等。

- **性能调优**  
  当系统响应变慢时，通过观察 r（运行队列）、si/so（交换速率）、wa（I/O 等待）等字段，可以初步定位性能瓶颈所在，从而进行相应优化。

- **问题排查**  
  如果发现某项指标异常（如上下文切换次数过高或交换活动频繁），可以结合 top、iostat 等工具进一步排查问题。

- **采样间隔**  
  选择合适的采样间隔非常重要。过短的间隔可能会导致数据波动较大，而过长的间隔则可能无法及时捕捉到瞬时异常。

> citeturn0search3

---

## 总结

vmstat 是一款非常有用的系统性能监控工具，通过简单的命令就能获得系统各方面的实时状态。无论是日常的系统监控、性能调优还是问题排查，了解 vmstat 各字段的含义和合理使用其选项都是系统管理员必备的技能之一。

希望以上详细介绍能帮助你更好地掌握 vmstat 命令的使用方法和输出解析！

# Reference
* [Linux vmstate 命令详解](https://chatgpt.com/share/67c9659f-586c-8009-9db8-2545bb47b10b)
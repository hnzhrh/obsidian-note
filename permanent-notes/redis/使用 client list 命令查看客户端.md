---
title: 使用 client list 命令查看客户端
tags:
  - permanent-note
  - middleware/redis/ops
date: 2025-03-12
time: 14:40
aliases: 
done: false
---
Redis 的 **`CLIENT LIST`** 命令用于查看当前连接到 Redis 服务器的所有客户端信息。执行该命令后，Redis 会返回一个包含每个客户端详细属性的列表，这些信息对于监控、调试和管理客户端连接非常有用。以下是详细的解释：

---

### **命令基本作用**
- **功能**: 列出所有连接到 Redis 的客户端信息，包括连接状态、配置参数、统计信息等。
- **权限**: 需要管理员权限（默认配置下可能需要认证）。
- **语法**: `CLIENT LIST`

---

### **返回字段详解**
每条客户端信息以多行字符串形式返回，字段之间用空格分隔。以下是常见字段及其含义：

#### **1. 基础信息**
- **`id`**: 客户端的唯一标识符（整数），用于区分不同客户端。
- **`addr`**: 客户端的 IP 地址和端口（例如 `127.0.0.1:63556`）。
- **`fd`**: Redis 内部使用的文件描述符编号（与操作系统相关）。
- **`name`**: 客户端自定义的名称（可通过 `CLIENT SETNAME` 设置，默认为空）。

#### **2. 连接状态**
- **`age`**: 客户端连接已建立的时长（单位：秒）。
- **`idle`**: 客户端最后一次交互后的空闲时间（单位：秒）。
- **`flags`**: 客户端类型和状态的标志（见下文详细说明）。
- **`db`**: 客户端当前选择的数据库编号（例如 `db=0`）。

#### **3. 阻塞与订阅**
- **`sub` / `psub`**: 客户端订阅的普通频道和模式频道的数量。
- **`multi`**: 当前是否在事务中（`-1` 表示未开启，`>0` 表示事务中的命令数）。
- **`qbuf` / `qbuf-free`**: 查询缓冲区总大小和剩余可用大小（字节）。
- **`obl` / `oll` / `omem`**: 输出缓冲区的长度、列表长度和占用内存（字节）。

#### **4. 资源与限制**
- **`cmd`**: 客户端最后一次执行的命令（例如 `cmd=ping`）。
- **`argv-mem`**: 客户端当前命令的参数占用的内存（仅某些版本支持）。
- **`multi-mem`**: 事务中命令占用的内存（仅某些版本支持）。
- **`events`**: 底层事件类型（如 `r` 表示可读，`w` 表示可写）。

#### **5. 标志（`flags` 字段）**
标志字段由字母缩写组成，常见值包括：
- **`N`**: 普通客户端（无特殊角色）。
- **`M`**: 主节点（在复制场景中）。
- **`S`**: 从节点（副本）。
- **`O`**: 客户端处于监控模式（执行了 `MONITOR` 命令）。
- **`x`**: 客户端正在执行事务。
- **`b`**: 客户端正在等待阻塞命令（如 `BLPOP`）。
- **`u`**: 客户端未被阻塞（与 `b` 互斥）。
- **`A`**: 连接需要尽快关闭。

---

### **使用场景**
1. **监控连接数**  
   检查当前连接数是否超出预期，防止资源耗尽。
   ```bash
   redis-cli CLIENT LIST | wc -l  # 统计连接数
   ```

2. **排查性能问题**  
   - 通过 `idle` 字段识别闲置连接，优化资源。
   - 通过 `omem` 字段发现输出缓冲区过大的客户端（可能占用过多内存）。

3. **调试阻塞操作**  
   查找 `flags=b` 的客户端，确认是否有命令长时间阻塞（如 `BLPOP` 未超时）。

4. **安全审计**  
   检查异常 IP 地址或未授权的连接。

---

### **示例输出解析**
假设执行 `CLIENT LIST` 后返回如下行：
```plaintext
id=5 addr=127.0.0.1:63556 fd=8 name= age=15 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=ping
```
- **`id=5`**: 客户端 ID 为 5。
- **`addr=127.0.0.1:63556`**: 来自本地 63556 端口的连接。
- **`flags=N`**: 普通客户端。
- **`idle=0`**: 最近刚执行过命令（无空闲）。
- **`cmd=ping`**: 最后一次执行的是 `PING` 命令。

---

### **注意事项**
1. **性能影响**  
   当客户端数量极大时，频繁执行 `CLIENT LIST` 可能影响 Redis 性能。
   
2. **字段变化**  
   不同 Redis 版本的输出字段可能略有差异，建议查阅对应版本的文档。

3. **敏感信息**  
   返回的信息可能包含客户端 IP 等敏感数据，需确保权限控制。

---

### **相关命令**
- **`CLIENT KILL <ip:port>`**: 断开指定客户端。
- **`CLIENT PAUSE <ms>`**: 暂停所有客户端连接。
- **`CLIENT SETNAME <name>`**: 为当前连接设置名称。

通过 `CLIENT LIST`，管理员可以全面掌握客户端连接状态，快速定位问题，是 Redis 运维中不可或缺的工具。

# Reference
* [CLIENT LIST \| Docs](https://redis.io/docs/latest/commands/client-list/)
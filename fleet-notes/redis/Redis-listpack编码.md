---
title: Redis-listpack编码
tags:
  - fleet-note
  - middleware/redis
date: 2024-11-23
time: 16:50
aliases:
---

在 Redis 中，`hash-max-listpack-entries` 和 `hash-max-listpack-value` 是与哈希（Hash）数据类型相关的两个配置选项。它们用于控制哈希内部使用的存储方式，特别是当哈希足够小时，Redis 会使用一种更紧凑的格式来存储这些值，称为 ziplist（在 Redis 4.0 之后被称为 listpack）。这种紧凑格式可以节省内存，但在某些情况下可能会导致性能下降。

### `hash-max-listpack-entries`

- **含义**：这个配置项指定了一个哈希对象可以包含的最大条目数，以便它仍然可以使用 listpack 存储。如果哈希中的条目数量超过了这个值，Redis 将停止使用 listpack，并转而使用更传统的哈希表结构来存储数据。
- **默认值**：512
- **作用**：通过设置这个值，你可以控制在什么点上 Redis 应该从使用 listpack 转换到使用标准哈希表。较小的值可以减少内存使用，但可能增加 CPU 开销；较大的值可以减少 CPU 开销，但可能会占用更多内存。

### `hash-max-listpack-value`

- **含义**：这个配置项定义了哈希对象中单个字段的最大长度（以字节为单位），使得该哈希仍然能够使用 listpack 存储。如果任何字段的大小超过此值，Redis 将不再使用 listpack 存储整个哈希对象。
- **默认值**：64 字节
- **作用**：这个配置帮助平衡内存使用和性能。较小的值可以确保更多的哈希对象保持在紧凑的 listpack 格式中，从而节省内存。然而，如果哈希中的值通常很大，那么较小的 `hash-max-listpack-value` 可能导致 Redis 频繁地将哈希对象转换为标准哈希表，这可能会对性能产生负面影响。

### 调整建议

调整这些参数时，需要根据你的应用需求和 Redis 实例的工作负载来决定。如果你的应用中哈希对象的数量和大小都比较小，可以考虑适当增加这些值以节省内存。反之，如果哈希对象较大或访问频率高，可能需要降低这些值以优化性能。

请注意，在修改这些配置之前，最好先备份你的 Redis 配置文件，并且在生产环境中进行此类更改前，建议先在一个测试环境中验证其效果。

# References